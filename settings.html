<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>設定</title>
    <link rel="stylesheet" href="src/styles/design-system.css">
    <link rel="stylesheet" href="src/styles/components.css">
    <link rel="stylesheet" href="settings.css">
</head>
<body>
    <div id="settings-container">
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" data-tab="display">画面表示設定</button>
                <button class="tab-button" data-tab="chat">会話設定</button>
                <button class="tab-button" data-tab="expressions">表情・アニメーション設定</button>
            </div>
            
            <main class="tab-content">
                <div class="tab-pane active" id="display-tab">
                    <section id="theme-section">
                        <div class="collapsible-header" id="theme-header">
                            <h2>🎨 デザインテーマ</h2>
                            <span class="collapse-icon">▼</span>
                        </div>
                        <div class="collapsible-content" id="theme-content">
                            <p class="section-description">アプリケーション全体の見た目と雰囲気を選択してください</p>
                            
                            <div class="theme-grid" id="theme-grid">
                            <!-- テーマ選択カードがJavaScriptで動的に生成されます -->
                            
                            <!-- 静的テーマカード（フォールバック） -->
                            <div class="theme-card" data-theme-id="default">
                                <div class="theme-header">
                                    <h3 class="theme-title">ソフト＆ドリーミー</h3>
                                </div>
                                <p class="theme-description">明るく親しみやすい、やわらかな印象のテーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #5082C4;"></div>
                                    <div class="theme-color" style="background-color: #8E7CC3;"></div>
                                    <div class="theme-color" style="background-color: #E91E63;"></div>
                                    <div class="theme-color" style="background-color: #FDFBF7;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                            
                            <div class="theme-card" data-theme-id="dark">
                                <div class="theme-header">
                                    <h3 class="theme-title">ダークモード</h3>
                                </div>
                                <p class="theme-description">目に優しく洗練された暗めのテーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #60A5FA;"></div>
                                    <div class="theme-color" style="background-color: #A78BFA;"></div>
                                    <div class="theme-color" style="background-color: #FCD34D;"></div>
                                    <div class="theme-color" style="background-color: #0F172A;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                            
                            <div class="theme-card" data-theme-id="sakura">
                                <div class="theme-header">
                                    <h3 class="theme-title">桜</h3>
                                </div>
                                <p class="theme-description">日本の春をイメージした温かみのあるテーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #D1477A;"></div>
                                    <div class="theme-color" style="background-color: #C485C7;"></div>
                                    <div class="theme-color" style="background-color: #FF5722;"></div>
                                    <div class="theme-color" style="background-color: #FDF2F8;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                            
                            <div class="theme-card" data-theme-id="ocean">
                                <div class="theme-header">
                                    <h3 class="theme-title">オーシャン</h3>
                                </div>
                                <p class="theme-description">海の静けさをイメージした爽やかなテーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #0D7377;"></div>
                                    <div class="theme-color" style="background-color: #1E40AF;"></div>
                                    <div class="theme-color" style="background-color: #DC7633;"></div>
                                    <div class="theme-color" style="background-color: #F0FDFA;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                            
                            <div class="theme-card" data-theme-id="forest">
                                <div class="theme-header">
                                    <h3 class="theme-title">フォレスト</h3>
                                </div>
                                <p class="theme-description">森の静寂をイメージした、落ち着いた自然派テーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #6B7280;"></div>
                                    <div class="theme-color" style="background-color: #8B7355;"></div>
                                    <div class="theme-color" style="background-color: #2D8659;"></div>
                                    <div class="theme-color" style="background-color: #F9FAFB;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                            
                            <div class="theme-card" data-theme-id="wonderland">
                                <div class="theme-header">
                                    <h3 class="theme-title">ワンダーランド</h3>
                                </div>
                                <p class="theme-description">不思議の国のアリスの幻想世界をイメージした魔法的なテーマ</p>
                                <div class="theme-preview">
                                    <div class="theme-color" style="background-color: #7C3AED;"></div>
                                    <div class="theme-color" style="background-color: #EC4899;"></div>
                                    <div class="theme-color" style="background-color: #10B981;"></div>
                                    <div class="theme-color" style="background-color: #FAF5FF;"></div>
                                </div>
                                <div class="theme-labels">
                                    <span class="theme-label">メイン</span>
                                    <span class="theme-label">サブ</span>
                                    <span class="theme-label">アクセント</span>
                                    <span class="theme-label">背景</span>
                                </div>
                            </div>
                        </div>
                        </div>
                    </section>
                    
                    <section id="window-size-section">
                        <h2>ウィンドウサイズ</h2>
                        
                        <div class="setting-group">
                            <label for="window-size-preset">プリセット:</label>
                            <select id="window-size-preset">
                                <option value="small">小 (300×600)</option>
                                <option value="medium" selected>中 (400×800)</option>
                                <option value="large">大 (500×1000)</option>
                                <option value="custom">カスタム</option>
                            </select>
                        </div>
                        
                        <div id="custom-size-inputs">
                            <div class="setting-group">
                                <label for="custom-width">幅:</label>
                                <input type="number" id="custom-width" min="200" max="1000" value="400">
                                <span>px</span>
                            </div>
                            
                            <div class="setting-group">
                                <label for="custom-height">高さ:</label>
                                <input type="number" id="custom-height" min="300" max="1200" value="800">
                                <span>px</span>
                            </div>
                        </div>
                    </section>
                    
                    <section id="vrm-model-section">
                        <h2>VRMモデル</h2>
                        
                        <div class="setting-group">
                            <label for="current-vrm-path">現在のモデル:</label>
                            <input type="text" id="current-vrm-path" readonly value="/avatar.vrm">
                        </div>
                        
                        <div class="setting-group">
                            <button id="select-vrm-model" type="button">モデルファイルを選択</button>
                        </div>
                    </section>
                    
                    <!-- 画面表示設定タブ専用ボタン -->
                    <div class="tab-button-group">
                        <button id="apply-display-settings" type="button" class="primary">画面表示設定を適用</button>
                        <button id="reset-display-settings" type="button" class="secondary">画面表示設定をリセット</button>
                    </div>
                </div>
                
                <div class="tab-pane" id="chat-tab">
                    <section id="names-section">
                        <h2>ユーザーとマスコットの名前</h2>
                        <p class="section-description">あなたの名前とマスコットの名前を設定してください</p>
                        
                        <div class="setting-group">
                            <label for="user-name">あなたの名前（ユーザー名）:</label>
                            <input type="text" id="user-name" placeholder="User" maxlength="50">
                        </div>
                        
                        <div class="setting-group">
                            <label for="mascot-name">マスコットの名前:</label>
                            <input type="text" id="mascot-name" placeholder="Mascot" maxlength="50">
                        </div>
                    </section>
                    
                    <section id="system-prompt-section">
                        <h2>システムプロンプト（キャラクターの性格・役割）</h2>
                        <p class="section-description">マスコットの基本的な性格や応答スタイルを記述してください。あなたの名前やマスコットの名前に関する指示は自動的に追加されます。</p>
                        
                        <div class="setting-group">
                            <label for="system-prompt-core">プロンプト内容:</label>
                        </div>
                        
                        <div class="setting-group">
                            <textarea id="system-prompt-core" placeholder="あなたは親しみやすく愛らしいAIアシスタントです。ユーザーと楽しく会話してください。" rows="8"></textarea>
                        </div>
                        
                        <div class="setting-group character-count-container">
                            <small class="character-count">文字数: <span id="prompt-character-count">0</span></small>
                            <small class="performance-warning" id="performance-warning" style="display: none;">
                                ⚠️ 入力トークンが長すぎるとモデルのパフォーマンスに影響が出る可能性があります
                            </small>
                        </div>
                        
                        <div class="setting-group">
                            <button id="reset-system-prompt" type="button" class="secondary">デフォルトに戻す</button>
                        </div>
                    </section>
                    
                    <section id="chat-history-section">
                        <h2>会話履歴</h2>
                        <p class="section-description">会話履歴の管理を行えます</p>
                        
                        <div class="setting-group">
                            <button id="clear-chat-history" type="button" class="danger">会話履歴をリセット</button>
                            <small class="button-description">この操作は元に戻せません</small>
                        </div>
                    </section>
                    
                    <!-- 会話設定タブ専用ボタン -->
                    <div class="tab-button-group">
                        <button id="apply-chat-settings" type="button" class="primary">会話設定を適用</button>
                        <button id="reset-chat-settings" type="button" class="secondary">会話設定をリセット</button>
                    </div>
                </div>
                
                <div class="tab-pane" id="expressions-tab">
                    <section id="expression-settings-section">
                        <h2>🎭 表情制御設定</h2>
                        <p class="section-description">AIが表情を変更する際に使用する表情と、その強度を設定してください</p>
                        
                        <div class="setting-group">
                            <div id="expression-loading" class="loading-message">
                                <span>VRMモデルから表情情報を読み込み中...</span>
                            </div>
                            
                            <div id="expression-list" class="expression-list" style="display: none;">
                                <!-- 表情リストがJavaScriptで動的に生成されます -->
                            </div>
                            
                            <div id="expression-error" class="error-message" style="display: none;">
                                <span>表情情報の読み込みに失敗しました。VRMモデルが正しく読み込まれているか確認してください。</span>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h3>プレビュー</h3>
                            <p class="subsection-description">設定した表情をリアルタイムで確認できます</p>
                            <div class="preview-controls">
                                <select id="preview-expression-select">
                                    <option value="">表情を選択...</option>
                                </select>
                                <div class="slider-group">
                                    <label for="preview-intensity">強度:</label>
                                    <input type="range" id="preview-intensity" min="0" max="1" step="0.1" value="1">
                                    <span id="preview-intensity-value">1.0</span>
                                </div>
                                <button id="preview-expression-btn" type="button" class="secondary">プレビュー</button>
                                <button id="reset-expression-btn" type="button" class="secondary">リセット</button>
                            </div>
                        </div>
                        
                        <!-- 表情・アニメーション設定タブ専用ボタン -->
                        <div class="tab-button-group">
                            <button id="apply-expression-settings" type="button" class="primary">適用</button>
                            <button id="reset-expression-settings" type="button" class="secondary">リセット</button>
                        </div>
                        
                        <div class="setting-info">
                            <h4>💡 使い方</h4>
                            <ul>
                                <li>チェックを入れた表情のみがAIによって使用されます</li>
                                <li>スライダーで各表情のデフォルト強度を調整できます</li>
                                <li>プレビュー機能で設定した表情を即座に確認できます</li>
                                <li>AIがintensity（強度）を指定した場合は、そちらが優先されます</li>
                            </ul>
                        </div>
                    </section>
                </div>
            </main>
        </div>
        
        <footer>
            <div class="button-group">
                <button id="close-settings" type="button" class="secondary">閉じる</button>
            </div>
        </footer>
    </div>
    
    <script type="module" src="/src/settings-renderer.ts"></script>
    <script type="module">
        import { ThemeManager } from '/src/utils/themeManager.ts';
        
        document.addEventListener('DOMContentLoaded', () => {
            const themeManager = new ThemeManager();
            
            // グローバルに公開してSettingsRendererから使用できるようにする
            window.themeManager = themeManager;
            console.log('ThemeManagerをグローバルに設定しました');
            
            // テーマ変更通知を受信
            if (window.electronAPI && window.electronAPI.onThemeChanged) {
                window.electronAPI.onThemeChanged((theme) => {
                    console.log('設定画面: テーマ変更通知を受信:', theme);
                    themeManager.setTheme(theme);
                });
            }
        });
    </script>
</body>
</html>